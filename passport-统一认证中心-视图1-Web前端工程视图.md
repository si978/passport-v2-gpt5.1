# Passport 统一认证中心 - 视图 1：Web 前端工程视图

> 说明：本视图从 Web 前端（React/Vue + TypeScript）角度审查《passport-统一认证中心-PRD-草稿.md》（Passport 统一认证中心 - PRD（V1 多视图对齐版））对代码实现的影响，重点关注页面结构、交互流程、前端状态管理以及与壳层/后端交互的 API。所有引用的 US/BR/FL 编号与主 PRD 保持一致。本视图仅作为对主 PRD 的工程补充说明与问题清单使用，如与主 PRD 存在任何不一致，应一律以主 PRD 为准。

---

## 1. 与前端相关的 US / BR / FL 覆盖总览

| 类型 | ID   | 在主 PRD 中的位置              | 对 Web 前端的相关性 | 视图结论 |
|------|------|--------------------------------|----------------------|----------|
| US   | US-01 | 4.1 手机号登录/注册           | 高                   | 存在输入校验与错误码定义缺口 |
| US   | US-02 | 4.1 跨客户端自动登录（SSO）   | 高                   | SSO 触发时机与前端角色边界存在缺口 |
| US   | US-03 | 4.1 网吧下机后自动登出        | 中                   | 壳层/前端职责边界需澄清 |
| US   | US-04 | 4.1 用户主动退出登录           | 高                   | 退出后前端状态重置流程需细化 |
| US   | US-05 | 4.1 后台查看用户信息与活跃明细 | 高                   | 筛选、分页、导出行为定义不完整 |
| BR   | BR-01~BR-03 | 5.1 GUID/手机号/Token 基础规则 | 中             | 规则较清晰，前端只需依赖 schema |
| BR   | BR-04 | 5.1 Token 刷新规则             | 高                   | 刷新触发策略与错误处理仍有实现空间 |
| BR   | BR-05 | 5.1 Token 验证规则             | 中                   | 更偏后端，前端只依赖 HTTP 结果 |
| BR   | BR-06 | 5.1 本地会话文件规则           | 中                   | 前端不应直接操作文件，需在文档中点明 |
| BR   | BR-07 | 5.1 会话 TTL 与全局退出规则    | 高                   | 退出后前端导航与状态清理需对齐 |
| BR   | BR-08 | 5.1 管理后台封禁/解封规则      | 高                   | 封禁时前端收到的错误码与流程未细化 |
| FL   | FL-01 | 6.1 手机号登录/注册流程        | 高                   | 表单与错误分支需要更结构化描述 |
| FL   | FL-02 | 6.1 Token 刷新流程             | 高                   | 前端/壳层负责刷新调度的边界未指明 |
| FL   | FL-03 | 6.1 Token 验证流程             | 中                   | 前端只关心 401/403 等反馈即可 |
| FL   | FL-04 | 6.1 跨客户端 SSO 流程          | 高                   | SSO 检查在壳层 vs 前端的分工不清 |
| FL   | FL-05 | 6.1 会话销毁（退出登录）       | 高                   | 前端退出交互与状态恢复需描述更细 |

---

## 2. 关键歧义点（会让 AI 前端代码生成出现多种实现）的清单

### 2.1 登录表单与验证码规则（US-01, FL-01, API-01, API-02）

**问题描述**

- PRD 中只说明“手机号 + 验证码登录/注册”，但未在文本里明确：
  - 手机号格式：是否仅支持大陆 11 位？是否支持国际区号？正则规则是什么；
  - 验证码长度与组成：例如固定 6 位数字，是否区分大小写；
  - 验证码有效期：多少分钟内有效；
  - 获取验证码按钮行为：冷却时间、是否在前端倒计时、按钮禁用条件；
  - 错误提示：不同错误码（格式错误/验证码错误/超时/过频）对应的前端提示是否统一管理。
- 这些缺口会导致 AI 在生成 React/Vue 表单组件时：
  - 可能选择不同的手机号正则与验证码长度；
  - 有的实现会在前端加倒计时，有的完全依赖后端错误；
  - 错误提示可能直接使用后端 message，而非统一的 i18n key。

**建议改写/补充（示意）**

- 在 BR 区新增一条：

```md
BR-09：手机号与验证码规则

- 手机号：
  - 仅支持中国大陆 11 位手机号，正则：`^1[3-9][0-9]{9}$`；
  - 前端在提交前需进行格式校验，格式错误时不调用 API-01/API-02。
- 验证码：
  - 长度固定为 6 位数字，正则：`^[0-9]{6}$`；
  - 有效期：5 分钟，在此时间窗口外一律视为过期。
- 获取验证码按钮：
  - 成功发送后按钮进入 60 秒倒计时，倒计时内再次点击不触发新请求；
  - 冷却期与最大请求次数限制见 ERR/风控说明。
- 前端错误提示：
  - 不同错误码（ERR_CODE_INVALID、ERR_CODE_EXPIRED、ERR_CODE_TOO_FREQUENT 等）映射到统一文案 key，详见第 13 章。
```

- 在 7.1 “手机号登录界面”中引用 BR-09，明确前端需要实现的交互与校验。

---

### 2.2 登录成功响应与状态管理（US-01, FL-01, API-02）

**问题描述**

- 文档仅笼统地说“签发 Access Token 和 Refresh Token”，未说明：
  - API-02 返回中是否同时包含 `guid`、`user_status`、`account_source` 等字段；
  - Token 是放在 `data` 结构中还是通过 HTTP header/cookie；
  - 前端全局状态（store）推荐保存哪些字段，以及如何与 LocalSession/Redis 会话对齐。
- AI 在生成前端 store/type 定义与登录流程时，会出现：
  - 有的实现只存 access_token，不存 guid；
  - 有的会把 refresh_token 存在 localStorage，有的只放内存；
  - 导致后续页面无法统一从全局状态中拿到 `guid` 和用户状态。

**建议改写/补充（示意）**

- 在 9.2 中补充 API-02 请求/响应示例（见“修订片段草稿”示例），并在 8.2 User 与 8.3 Session 处补一句：

```md
前端全局状态建议包含：`guid`、`access_token`、`refresh_token`、`user_status`、`account_source` 等字段，其来源为 API-02 登录成功响应的 `data` 字段。
```

---

### 2.3 SSO 检查与壳层职责边界（US-02, FL-04, BR-06）

**问题描述**

- FL-04 中描述“游利社检测本地会话文件并解密”，未显式说明这是壳层逻辑还是前端逻辑：
  - 若 AI 误以为这是前端逻辑，会尝试在 React/Vue 代码里直接访问文件系统路径和 DPAPI（在浏览器上下文并不现实）；
  - 即便在 Electron 环境，最佳实践也应是主进程/原生模块负责文件读写，前端只消费结果。

**建议改写/补充（示意）**

- 在 FL-04 中增加“壳层启动策略”子节（详见上一轮回答中的示例），明确：
  - “检测本地会话文件、解密与完整性校验”的操作由壳层/原生模块完成；
  - 前端只通过 IPC 收到 `session.status` 与 `guid`、`refresh_token` 等信息。

---

### 2.4 管理后台筛选与导出（US-05, 7.2, DM-04）

**问题描述**

- 文档仅说“按手机号模糊搜索”、“可按筛选导出”，但未说明：
  - 分页参数字段名（`page`/`pageIndex`，`pageSize`/`limit`）；
  - 默认排序（按登录时间 desc？）；
  - 导出格式（CSV vs Excel）、是否异步导出、最大行数限制。
- AI 生成管理后台时会自由选择分页与导出协议，导致后端/前端不一致。

**建议改写/补充（示意）**

- 在 7.2 或 DM-04 下增加一小节：

```md
后台列表统一分页与导出规范：

- 分页参数：
  - Query: `page_index`（从 1 开始）、`page_size`（默认 20，最大 100）。
  - 响应中包含：`total`（总条数）、`items`（当前页数据数组）。
- 默认排序：
  - 用户信息表：按注册时间倒序。
  - 用户活跃表：按登录时间倒序。
- 导出：
  - 通过独立接口触发导出（例如 `/export/user-activity`），导出格式为 CSV；
  - 单次导出最大行数为 10 万行，超过时需提示用户缩小筛选范围。
```

---

> 其它 BR/FL 对前端的影响相对明确（例如 BR-03 Token 有效期、BR-07 会话 TTL），AI 主要需要的是 API schema 与错误码补全，已经在上文中指出“缺口”。
