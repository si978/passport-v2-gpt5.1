# Passport 统一认证中心 - 迁移与高可用方案（草案）

> 目的：响应 PRD 第 14 章与 C-06/C-07 中对迁移与高可用的占位性要求，给出 V1 阶段的基本假设与后续演进方向，避免在开发阶段对“是否需要迁移 / 如何做 HA”存在理解分歧。

---

## 1. V1 阶段的前提假设

1. **新系统，无历史数据迁移**：
   - V1 上线时视为新的 Passport 系统，不承担老系统（如既有登录系统）的历史 GUID / 用户数据迁移；
   - 老系统到新系统的迁移方案（若存在）由后续专项项目负责，不在本期开发范围内。
2. **单 Region 部署 + 基本高可用**：
   - V1 采用单 Region 部署，满足：
     - Redis / DB 具备故障切换能力（主从或哨兵 / 集群模式）；
     - Passport 服务无状态，支持多实例水平扩展；
   - 多 Region / 跨 Region 容灾留待后续版本评估。

---

## 2. 与 PRD 14 章 / C-06 / C-07 的关系

- PRD 14 章：《兼容性 & 迁移》：
  - 当前版本中仅作为占位，说明迁移方案由独立文档负责；
  - 本草案即为该独立文档的初版，明确 V1 假设与不做事项。
- C-06：迁移策略由迁移方案文档负责，不在 PRD 中硬编码；
- C-07：Redis 高可用与多机部署的一致性由架构 / 运维设计文档负责。

> 本草案将上述“职责边界”具体化，明确 V1 不做的部分与未来需关注的方向。

---

## 3. 未来迁移场景（非 V1 范围，仅列出 TODO）

- 老用户 GUID 迁移：
  - 如何将历史系统中的用户 ID / GUID 映射到 Passport GUID；
  - 是否允许在迁移过程中变更用户 GUID，或采用“虚 GUID + 关联表”方案；
  - 对统计 / 审计的影响。
- 历史登录日志导入：
  - 是否需要将旧系统中的活跃数据导入 LoginLog；
  - 一致性与存储成本评估。

---

## 4. 高可用与一致性原则（概要）

- 会话一致性：
  - 在单 Region 范围内，Redis 作为唯一在线会话存储，退出 = 全局退出；
  - 多 Region 架构下需确保“退出 / 封禁”操作能在各 Region 生效（例如通过消息总线广播失效事件）。
- 数据一致性：
  - 用户数据（User 表）以强一致为目标（单主写，多从读或强一致集群）；
  - 日志数据（LoginLog）允许最终一致，但需保证不丢失关键审计记录。

> 以上原则在未来正式设计 HA 架构时需被遵守，本草案仅起到“记事本 / 提醒”作用，不对当前 V1 开发构成额外约束。
