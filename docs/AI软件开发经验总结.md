# AI 软件开发经验总结

> 可复用的 AI 协作开发经验，适用于中小型全栈项目。

---

## 1. 文档驱动开发

### 1.1 单一事实源 (SSoT)
- PRD 作为唯一权威需求文档
- 决策记录分层：产品层 Q-xx、工程层 C-xx
- **量化**：每 3-5 个 AI 会话整理一次关键结论

### 1.2 多视图文档
按角色拆分：前端/后端/测试/架构，避免单一文档过长（建议 < 500 行/文档）

### 1.3 教训：文档滞后
| 问题 | 后果 | 解决 |
|------|------|------|
| 会话结论未及时记录 | 新会话重复讨论相同问题 | 每次会话结束前整理 3-5 条关键结论 |
| 多文档定义冲突 | 实现与需求不一致 | 建立文档优先级：PRD > 技术方案 > 视图文档 |

---

## 2. 测试策略

### 2.1 三层测试
| 层级 | 目的 | 覆盖率目标 |
|------|------|-----------|
| PoC 测试 | 验证业务逻辑 | 核心流程 100% |
| 单元测试 | 生产代码覆盖 | > 80% |
| E2E 测试 | 端到端验证 | 主流程 100% |

### 2.2 契约化测试
- stub/mock 响应格式**必须**与真实 API 一致
- **检查频率**：每次 API 变更后立即同步 stub

### 2.3 教训：stub 与契约不同步
| 问题 | 现象 | 解决 |
|------|------|------|
| stub 缺少必填字段 | 测试通过但生产报错 `ValueError: expires_at earlier than created_at` | stub 响应从契约文档自动生成或手动对齐 |
| mock 数据格式过时 | 测试绿灯但集成失败 | 每次契约变更同步更新所有 stub |

---

## 3. 多技术栈协同

### 3.1 参考实现模式
```
快速原型 (Python/脚本) → 契约文档 (DTO/错误码) → 生产实现 (TypeScript/Java)
```

### 3.2 契约文档内容
- DTO 类型定义（字段名、类型、是否必填）
- 错误码定义（code、message、HTTP status）
- 流程时序图

### 3.3 教训：多客户端配置不一致
| 问题 | 现象 | 解决 |
|------|------|------|
| 客户端 A 用 HTTPS，客户端 B 用 HTTP | SSO 失败，会话无法共享 | 配置项提取到统一常量文件，构建时注入 |
| 硬编码 URL 分散在多个文件 | 修改遗漏导致部分功能异常 | 全局搜索 `http://` 和 `https://` 确认一致性 |

---

## 4. 部署与运维

### 4.1 容器化部署
- 使用 Docker Compose 统一本地和生产环境
- 服务拆分：backend / frontend / database / cache

### 4.2 安全配置
- 管理后台**不直接暴露**公网端口，通过反向代理访问
- HTTPS 强制，HTTP 自动跳转

### 4.3 健康检查
- 端点：`/api/health` 或 `/health`
- 返回：`{ status, timestamp, uptime }`
- **检查频率**：每 30 秒

---

## 5. 版本管理

### 5.1 提交前检查清单
```bash
# 1. 运行测试
npm test && npm run build

# 2. 检查敏感信息
git diff --cached | grep -E "(password|secret|key|token)" 

# 3. 确认变更范围
git status
```

### 5.2 量化指标
| 指标 | 建议值 |
|------|--------|
| 单次提交文件数 | < 10 个 |
| 单次提交行数 | < 500 行 |
| 提交前测试 | 必须全绿 |

---

## 6. 验收机制

### 6.1 检查清单模板
| 类别 | 检查项 | 通过标准 |
|------|--------|----------|
| 功能 | 核心流程 | 100% 可用 |
| 安全 | HTTPS/Token | 无明文传输 |
| 性能 | API 响应 | < 2 秒 |

### 6.2 问题分级
| 级别 | 定义 | 响应时间 |
|------|------|----------|
| P0 | 阻塞核心功能 | 立即 |
| P1 | 严重影响体验 | 4 小时内 |
| P2 | 一般问题 | 1 天内 |
| P3 | 轻微/建议 | 下版本 |

---

## 7. 问题排查方法

### 7.1 对比分析法
1. 找到正常工作的参照物（另一个客户端/环境）
2. 逐项对比配置差异
3. 定位不一致项

### 7.2 增量验证法
- 每修复一个问题立即验证
- **不要**积累多个修改后再验证
- 验证失败立即回滚

### 7.3 教训：构建后才发现配置错误
| 问题 | 后果 | 解决 |
|------|------|------|
| 修改源码后未重新构建 | 运行的是旧版本 | 建立"修改-构建-验证"流水线 |
| 多个配置文件未同步修改 | 部分功能异常 | 使用 grep 全局搜索相关配置项 |

---

## 8. AI 协作最佳实践

### 8.1 有效提示技巧
| 场景 | 好的提示 | 差的提示 |
|------|----------|----------|
| 定位问题 | "对比这两个文件的 URL 配置" | "帮我看看代码" |
| 修复 bug | "修复 X 文件第 Y 行的 Z 问题" | "代码有问题" |
| 新功能 | "参考 A 模块实现 B 功能" | "加个功能" |

### 8.2 AI 容易出错的场景
| 场景 | 风险 | 人工检查重点 |
|------|------|-------------|
| 多文件同步修改 | 遗漏部分文件 | 全局搜索确认 |
| 配置项修改 | 硬编码分散 | grep 相关关键词 |
| 删除代码 | 误删依赖代码 | 运行完整测试 |

### 8.3 人工审查清单
- [ ] 安全：无硬编码密钥/密码
- [ ] 一致性：多处配置是否同步
- [ ] 完整性：是否遗漏相关文件
- [ ] 测试：是否通过全量测试

### 8.4 量化建议
| 指标 | 建议值 |
|------|--------|
| 单次任务复杂度 | 1-3 个文件 |
| 会话整理频率 | 每 3-5 次会话 |
| 代码审查时间 | 每 100 行 5 分钟 |

---

## 9. 工具链

### 9.1 AI 编程工具
| 工具 | 优点 | 缺点 | 适用场景 |
|------|------|------|----------|
| Factory Droid | 上下文理解强、可执行命令 | 需要清晰指令 | 全栈开发、调试 |
| GitHub Copilot | 代码补全快 | 上下文有限 | 单文件编码 |
| ChatGPT | 解释能力强 | 无法执行 | 方案讨论 |

### 9.2 必备命令
```bash
# 全局搜索配置项
grep -r "http://" --include="*.py" --include="*.ts"

# 查找相似文件
find . -name "*client*.py"

# 对比文件差异
diff file_a.py file_b.py
```

---

## 10. 项目启动阶段

### 10.1 让 AI 快速理解代码库
| 步骤 | 操作 | 目的 |
|------|------|------|
| 1 | 提供 README 和项目结构 | 建立整体认知 |
| 2 | 说明技术栈和框架版本 | 避免使用过时/不兼容 API |
| 3 | 指出核心文件和入口点 | 聚焦关键代码 |
| 4 | 说明编码规范和约定 | 保持风格一致 |

### 10.2 推荐的项目结构
```
project/
├── docs/               # 文档（PRD、技术方案、会话整理）
├── src/ 或 dev/        # 源代码
│   ├── backend/        # 后端服务
│   ├── frontend/       # 前端应用
│   └── shared/         # 共享代码（类型、工具函数）
├── tests/              # 测试代码
├── deploy/             # 部署配置
└── scripts/            # 构建/运维脚本
```

### 10.3 命名约定
| 类型 | 约定 | 示例 |
|------|------|------|
| 文件名 | 小写 + 下划线/短横线 | `user_service.py`, `user-list.tsx` |
| 类名 | PascalCase | `UserService`, `LoginPage` |
| 函数/变量 | camelCase 或 snake_case（按语言） | `getUserById`, `get_user_by_id` |
| 常量 | UPPER_SNAKE_CASE | `MAX_RETRY_COUNT` |
| 配置文件 | 统一位置，环境区分 | `config/dev.env`, `config/prod.env` |

### 10.4 启动会话模板
```markdown
## 项目背景
- 项目名称：XXX
- 技术栈：Python 3.12 + NestJS + React 18
- 当前阶段：开发/测试/维护

## 代码结构
- 入口文件：src/main.ts
- 核心模块：src/modules/
- 配置文件：config/

## 本次任务
[具体描述]

## 约束条件
- 不修改 XX 模块
- 保持与 YY 接口兼容
```

### 10.5 教训：AI 不了解项目上下文
| 问题 | 后果 | 解决 |
|------|------|------|
| 未说明技术栈版本 | AI 使用已废弃的 API | 首次会话明确版本号 |
| 未指出已有工具函数 | AI 重复造轮子 | 提供 utils/helpers 目录清单 |
| 未说明编码规范 | 生成代码风格不一致 | 提供 .eslintrc 或示例代码 |

---

## 变更记录

| 日期 | 说明 |
|------|------|
| 2026-01-12 | v2.1 - 增加项目启动阶段经验 |
| 2026-01-12 | v2.0 - 增加教训案例、量化指标、工具链说明 |
| 2026-01-12 | v1.0 - 初始版本 |
